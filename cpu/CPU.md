# cpu的结构及原理及使用场景
## 1. 基本组成部分
 - 运算逻辑单元: ALU(Arithmetic Logic Unit) 包含运算和逻辑治理单元
 - 控制单元: CU(Control Unit) 从内存中取指令并解释它们,并控制其他部分的工作
 - 寄存器: Registers, 用于临时数据的存储和指令的高速存储
 - 缓存: Cache, 小容量当高速的存储容器, 用于频繁访问的数据,减少访问内容的时间.
 - 内存管理器: MMU(Memory Management Unit), 负责内存的分配和回收, 以及地址转换. 以及虚拟内存的管理
 - 存储器: Memory, 存储数据, 存储器分为静态存储器(ROM)和动态存储器(RAM)
 - 输入输出设备: I/O Devices, 用于输入和输出数据的设备
 ## 2. 指令周期 Instruction Cycle
 - 取指: Fetch 从内存中取出指令.
 - 译码: Decode 解释指令,确定操作数和操作类型.
 - 执行: Execute 在ALU中执行指令.
 - 写回: Write Back 将结果写回寄存器或内存.

## 3. 流水线 Pipeline
- 将指令的执行分成多个阶段(如取指、译码、执行、写回),每个阶段可以并行处理不同的指令,从而提高处理的效率. 在doris中用到了流水线这里的设计

## 4. 超标量 Superscalar
- CPU具有多个执行单元, 可以在一个时钟周期内执行多条指令,从而提高指令的吞吐量

## 5. 超线程 Hyper-Threading
- 通过模拟多个逻辑处理器在一个物理处理器上执行多个线程,提升多任务处理能力.

## 多核 Multi-Core
- CPU包含多个独立的处理核心,每个核心可以独立执行之力, 提升多任务处理能力

# 我们在开发中需要考虑cpu的地方
## 1. 缓存分级
### 缓存分级
- 一级缓存(L1Cache)
    - 位置: 位于CPU核心内部
    - 大小: 通常为16KB到128KB(想想为什么是这个数据),每个CPU核心都有自己的L1缓存
- 二级缓存(L2Cache)
- 三级缓存(L3Cache)
- 四级缓存(L4Cache)
- 
## 2. 缓存优化
- 缓存优化: Cache Line 现代CPU缓存按缓存行存储数据, 通常是64字节,程序应尽量避免缓存行冲突和伪共享(False Sharing).
    - 缓存行冲突: 当多个线程同时访问同一缓存行时,可能会导致缓存行被修改,从而影响其他线程的缓存一致性.
    - 伪共享: 当多个线程同时访问同一缓存行时,可能会导致缓存行被修改,从而影响其他线程的缓存一致性.在多核处理器系统中,各个核心有自己的私有缓存(L1、L2缓存).为了保证各核心缓存的一致性,CPU使用缓存一致性协议(如MESI协议)来协调不同核心的缓存(为什么需要保证缓存一致性: 保证缓存一致性的主要目的是为了确保系统中的所有的缓存视图和主内存中的内存视图保持一致性,从而编码数据的不一致性和冲突. ). 当多个核心同时访问同一缓存行中的不同变量时,即使这些核心访问的是不同的变量,缓存一致性协议仍会将这些访问视为对同一缓存行的访问. 这样会引发几个问题: 
        - 缓存行无效化: 当一个核心对缓存行中的数据进行写操作时, 其他核心中的同一缓存行的副本会被标记为无效,这就意味着其他核心必须重新从主内存或更高一级的缓存中加载缓存行,从而增加延迟.
        - 频繁的数据传输: 由于缓存行的无效化,核心之间需要频繁地传输数据,增加了总线和内存的[带宽消耗](zongxian.md). [我们想想java中的voalitle能否解决缓存行伪共享的问题](jvm_cpu.md)
- 缓存命中